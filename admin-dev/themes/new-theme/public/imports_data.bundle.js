/******/!function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}// webpackBootstrap
/******/
var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=445)}({203:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(269);(0,window.$)(function(){new o.a})},267:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=window.$,a=function(){function t(){o(this,t)}return r(t,null,[{key:"validate",value:function(){return i(".js-validation-error").addClass("d-none"),this._checkDuplicateSelectedValues()&&this._checkRequiredFields()}},{key:"_checkDuplicateSelectedValues",value:function(){var t=[],e=!0;return i(".js-entity-field select").each(function(){var n=i(this).val();if("no"!==n)return-1!==i.inArray(n,t)?(e=!1,void i(".js-duplicate-columns-warning").removeClass("d-none")):void t.push(n)}),e}},{key:"_checkRequiredFields",value:function(){var t=i(".js-import-data-table").data("required-fields");for(var e in t)if(0===i('option[value="'+t[e]+'"]:selected').length)return i(".js-missing-column-warning").removeClass("d-none"),i(".js-missing-column").text(i('option[value="'+t[e]+'"]:first').text()),!1;return!0}}]),t}();e.a=a},268:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(){o(this,t),this._targetExecutionTime=5e3,this._maxAcceleration=4,this._minBatchSize=5,this._maxBatchSize=100}return r(t,[{key:"markImportStart",value:function(){this._importStartTime=(new Date).getTime()}},{key:"markImportEnd",value:function(){this._actualExecutionTime=(new Date).getTime()-this._importStartTime}},{key:"_calculateAcceleration",value:function(){return Math.min(this._maxAcceleration,this._targetExecutionTime/this._actualExecutionTime)}},{key:"calculateBatchSize",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this._importStartTime)throw"Import start is not marked.";if(!this._actualExecutionTime)throw"Import end is not marked.";var n=[this._maxBatchSize,Math.max(this._minBatchSize,Math.floor(t*this._calculateAcceleration()))];return e>0&&n.push(e),Math.min.apply(Math,n)}}]),t}();e.a=i},269:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=n(271),i=n(270),a=n(267),s=n(273),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),l=function(){function t(){var e=this;o(this,t),new r.a,new i.a,this.importer=new s.a,$(document).on("click",".js-process-import",function(t){return e.importHandler(t)}),$(document).on("click",".js-abort-import",function(){return e.importer.requestCancelImport()}),$(document).on("click",".js-close-modal",function(){return e.importer.progressModal.hide()}),$(document).on("click",".js-continue-import",function(){return e.importer.continueImport()})}return u(t,[{key:"importHandler",value:function(t){if(t.preventDefault(),a.a.validate()){var e={};$(".import-data-configuration-form").find("#skip, select[name^=type_value], #csv, #iso_lang, #entity,#truncate, #match_ref, #regenerate, #forceIDs, #sendemail,#separator, #multiple_value_separator").each(function(t,n){e[$(n).attr("name")]=$(n).val()}),this.importer.import($(".js-import-process-button").data("import_url"),e)}}}]),t}();e.a=l},270:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=window.$,a=i(".js-import-data-table"),s=function(){function t(){var e=this;o(this,t),this.numberOfColumnsPerPage=this._getNumberOfVisibleColumns(),this.totalNumberOfColumns=this._getTotalNumberOfColumns(),i(".js-import-next-page").on("click",function(){return e.importNextPageHandler()}),i(".js-import-previous-page").on("click",function(){return e.importPreviousPageHandler()})}return r(t,[{key:"importNextPageHandler",value:function(){this._importPaginationHandler("forward")}},{key:"importPreviousPageHandler",value:function(){this._importPaginationHandler("backward")}},{key:"_importPaginationHandler",value:function(t){var e=a.find("th:visible,td:visible"),n=i("forward"===t?".js-import-next-page":".js-import-previous-page"),o=!1,r=0,s=a.find("th");"backward"===t&&(s=i(s.toArray().reverse()));for(var u in s){if(isNaN(u)){this._hide(n);break}if(i(s[u]).is(":visible"))o=!0;else if(o){var l="backward"===t?this.totalNumberOfColumns-1-u:u;if(this._showTableColumnByIndex(l),++r>=this.numberOfColumnsPerPage){this._hide(n);break}}}this._hide(e),a.find("th:first").is(":visible")||this._show(i(".js-import-previous-page")),a.find("th:last").is(":visible")||this._show(i(".js-import-next-page"))}},{key:"_getNumberOfVisibleColumns",value:function(){return a.find("th:visible").length}},{key:"_getTotalNumberOfColumns",value:function(){return a.find("th").length}},{key:"_hide",value:function(t){t.addClass("d-none")}},{key:"_show",value:function(t){t.removeClass("d-none")}},{key:"_showTableColumnByIndex",value:function(t){t++,this._show(a.find("th:nth-child("+t+")")),this._show(a.find("tbody > tr").find("td:nth-child("+t+")"))}}]),t}();e.a=s},271:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=window.$,a=function(){function t(){o(this,t),this.loadEvents()}return r(t,[{key:"loadEvents",value:function(){var t=this;i(document).on("click",".js-save-import-match",function(e){return t.save(e)}),i(document).on("click",".js-load-import-match",function(e){return t.load(e)}),i(document).on("click",".js-delete-import-match",function(e){return t.delete(e)})}},{key:"save",value:function(t){var e=this;t.preventDefault();var n=i(".js-save-import-match").attr("data-url"),o=i(".import-data-configuration-form").serialize();i.ajax({type:"POST",url:n,data:o}).then(function(t){if(void 0!==t.errors&&t.errors.length)e._showErrorPopUp(t.errors);else if(t.matches.length>0){var n=e.matchesDropdown;for(var o in t.matches){var r=n.find("option[value="+t.matches[o].id_import_match+"]");r.length>0||e._appendOptionToDropdown(n,t.matches[o].name,t.matches[o].id_import_match)}}})}},{key:"load",value:function(t){var e=this;t.preventDefault();var n=i(".js-load-import-match").attr("data-url");i.ajax({type:"GET",url:n,data:{import_match_id:this.matchesDropdown.val()}}).then(function(t){if(t){e.rowsSkipInput.val(t.skip);var n=t.match.split("|");for(var o in n)i("#type_value_"+o).val(n[o])}})}},{key:"delete",value:function(t){t.preventDefault();var e=i(".js-delete-import-match").attr("data-url"),n=this.matchesDropdown,o=n.val();i.ajax({type:"DELETE",url:e,data:{import_match_id:o}}).then(function(){n.find("option[value="+o+"]").remove()})}},{key:"_appendOptionToDropdown",value:function(t,e,n){var o=i("<option>");o.attr("value",n),o.text(e),t.append(o)}},{key:"_showErrorPopUp",value:function(t){alert(t)}},{key:"matchesDropdown",get:function(){return i("#matches")}},{key:"rowsSkipInput",get:function(){return i("#skip")}}]),t}();e.a=a},272:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(){o(this,t)}return r(t,[{key:"show",value:function(){this.progressModal.modal("show")}},{key:"hide",value:function(){this.progressModal.modal("hide")}},{key:"updateProgress",value:function(t,e){t=parseInt(t),e=parseInt(e);var n=this.progressBar,o=t/e*100;n.css("width",o+"%"),n.find("> span").text(t+"/"+e)}},{key:"updateProgressLabel",value:function(t){this.progressLabel.text(t)}},{key:"setImportingProgressLabel",value:function(){this.updateProgressLabel(this.progressModal.find(".modal-body").data("importing-label"))}},{key:"setImportedProgressLabel",value:function(){this.updateProgressLabel(this.progressModal.find(".modal-body").data("imported-label"))}},{key:"showInfoMessages",value:function(t){this._showMessages(this.infoMessageBlock,t)}},{key:"showWarningMessages",value:function(t){this._showMessages(this.warningMessageBlock,t)}},{key:"showErrorMessages",value:function(t){this._showMessages(this.errorMessageBlock,t)}},{key:"showSuccessMessage",value:function(){this.successMessageBlock.removeClass("d-none")}},{key:"showPostLimitMessage",value:function(t){this.postLimitMessage.find("#post_limit_value").text(t),this.postLimitMessage.removeClass("d-none")}},{key:"_showMessages",value:function(t,e){var n=!1;for(var o in e){n=!0;var r=$("<div>");r.text(e[o]),r.addClass("message"),t.append(r)}n&&t.removeClass("d-none")}},{key:"showContinueImportButton",value:function(){this.continueImportButton.removeClass("d-none")}},{key:"hideContinueImportButton",value:function(){this.continueImportButton.addClass("d-none")}},{key:"showAbortImportButton",value:function(){this.abortImportButton.removeClass("d-none")}},{key:"hideAbortImportButton",value:function(){this.abortImportButton.addClass("d-none")}},{key:"showCloseModalButton",value:function(){this.closeModalButton.removeClass("d-none")}},{key:"hideCloseModalButton",value:function(){this.closeModalButton.addClass("d-none")}},{key:"clearWarningMessages",value:function(){this.warningMessageBlock.addClass("d-none").find(".message").remove()}},{key:"reset",value:function(){this.updateProgress(0,0),this.updateProgressLabel(this.progressLabel.attr("default-value")),this.continueImportButton.addClass("d-none"),this.abortImportButton.addClass("d-none"),this.closeModalButton.addClass("d-none"),this.successMessageBlock.addClass("d-none"),this.infoMessageBlock.addClass("d-none").find(".message").remove(),this.errorMessageBlock.addClass("d-none").find(".message").remove(),this.postLimitMessage.addClass("d-none"),this.clearWarningMessages()}},{key:"progressModal",get:function(){return $("#import_progress_modal")}},{key:"progressBar",get:function(){return this.progressModal.find(".progress-bar")}},{key:"infoMessageBlock",get:function(){return $(".js-import-info")}},{key:"errorMessageBlock",get:function(){return $(".js-import-errors")}},{key:"warningMessageBlock",get:function(){return $(".js-import-warnings")}},{key:"successMessageBlock",get:function(){return $(".js-import-success")}},{key:"postLimitMessage",get:function(){return $(".js-post-limit-warning")}},{key:"continueImportButton",get:function(){return $(".js-continue-import")}},{key:"abortImportButton",get:function(){return $(".js-abort-import")}},{key:"closeModalButton",get:function(){return $(".js-close-modal")}},{key:"progressLabel",get:function(){return $("#import_progress_bar").find(".progress-details-text")}}]),t}();e.a=i},273:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=n(272),i=n(268),a=n(274),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=function(){function t(){o(this,t),this.configuration={},this.progressModal=new r.a,this.batchSizeCalculator=new i.a,this.postSizeChecker=new a.a,this.defaultBatchSize=5}return s(t,[{key:"import",value:function(t,e){this._mergeConfiguration(e),this.importUrl=t,this.totalRowsCount=0,this.hasWarnings=!1,this.hasErrors=!1,this.progressModal.reset(),this.progressModal.show(),this._ajaxImport(0,this.defaultBatchSize)}},{key:"_ajaxImport",value:function(t,e){var n=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._mergeConfiguration({offset:t,limit:e,validateOnly:o?1:0,crossStepsVars:JSON.stringify(r)}),this._onImportStart(),$.post({url:this.importUrl,dataType:"json",data:this.configuration,success:function(r){if(n._importCancelRequested)return n._cancelImport(),!1;var i=r.errors&&r.errors.length,a=r.warnings&&r.warnings.length,s=r.notices&&r.notices.length;if(void 0!==r.totalCount&&r.totalCount&&(n.totalRowsCount=r.totalCount),n.progressModal.updateProgress(r.doneCount,n.totalRowsCount),o||n.progressModal.setImportingProgressLabel(),!o&&s&&n.progressModal.showInfoMessages(r.notices),i){if(n.hasErrors=!0,n.progressModal.showErrorMessages(r.errors),!o)return n._onImportStop(),!1}else a&&(n.hasWarnings=!0,n.progressModal.showWarningMessages(r.warnings));if(!r.isFinished){n.batchSizeCalculator.markImportEnd();var u=t+e,l=n.batchSizeCalculator.calculateBatchSize(e,n.totalRowsCount);return n.postSizeChecker.isReachingPostSizeLimit(r.postSizeLimit,r.nextPostSize)&&n.progressModal.showPostLimitMessage(n.postSizeChecker.getRequiredPostSizeInMegabytes(r.nextPostSize)),n._ajaxImport(u,l,o,r.crossStepsVariables)}if(o)return n.hasErrors?(n._onImportStop(),!1):n.hasWarnings?(n.progressModal.showContinueImportButton(),n._onImportStop(),!1):(n.progressModal.updateProgress(n.totalRowsCount,n.totalRowsCount),n._ajaxImport(0,n.defaultBatchSize,!1));n._onImportFinish()},error:function(t,e,o){"parsererror"===e&&(e="Technical error: Unexpected response returned by server. Import stopped."),n._onImportStop(),n.progressModal.showErrorMessages([e])}})}},{key:"continueImport",value:function(){if(!this.configuration)throw"Missing import configuration. Make sure the import had started before continuing.";this.progressModal.hideContinueImportButton(),this.progressModal.hideCloseModalButton(),this.progressModal.clearWarningMessages(),this._ajaxImport(0,this.defaultBatchSize,!1)}},{key:"requestCancelImport",value:function(){this._importCancelRequested=!0}},{key:"_mergeConfiguration",value:function(t){for(var e in t)this._importConfiguration[e]=t[e]}},{key:"_cancelImport",value:function(){this.progressModal.hide(),this._importCancelRequested=!1}},{key:"_onImportStop",value:function(){this.progressModal.showCloseModalButton(),this.progressModal.hideAbortImportButton()}},{key:"_onImportFinish",value:function(){this._onImportStop(),this.progressModal.showSuccessMessage(),this.progressModal.setImportedProgressLabel(),this.progressModal.updateProgress(this.totalRowsCount,this.totalRowsCount)}},{key:"_onImportStart",value:function(){this.batchSizeCalculator.markImportStart(),this.progressModal.showAbortImportButton()}},{key:"configuration",set:function(t){this._importConfiguration=t},get:function(){return this._importConfiguration}},{key:"progressModal",set:function(t){this._modal=t},get:function(){return this._modal}}]),t}();e.a=u},274:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(){o(this,t),this.postSizeLimitThreshold=.9}return r(t,[{key:"isReachingPostSizeLimit",value:function(t,e){return e>=t*this.postSizeLimitThreshold}},{key:"getRequiredPostSizeInMegabytes",value:function(t){return parseInt(t/1048576)}}]),t}();e.a=i},445:function(t,e,n){t.exports=n(203)}});