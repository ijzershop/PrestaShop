!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";e.fn.plateCutVisualizer=function(t){e.fn.plateCutVisualizer.defaults={plateHeight:500,plateWidth:1e3,minCutSize:150,maxCuts:26,cutLineWidth:3,plateCutHistory:[],state:null,fontSizePX:18,plateBorder:1,plateOrientation:"landscape",cutIdArray:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],activePlateBackgroundColor:"rgba(51,56,255,0.5)",plateBackgroundColor:"#ccc",plateBorderColor:"#fff",plateLetterColor:"#000",visualCutLineColor:"#fff",visualCutLineErrorColor:"#dc3545",visualCutLineDashArray:[10,5],plateLetterFontFamily:'"Arial Black", Gadget, sans-serif',plateLetterFontWeight:400,technicalPlateCutReferenceArray:[]};var n=e.extend({},e.fn.plateCutVisualizer.defaults,t),i=function(e){switch(e){case"cut_to_small":return"De ingevoerde maat is te klein, de minimale knipmaat is "+n.minCutSize+"mm";case"remainder_to_small":return"Het rest-deel is kleiner dan de minimale rest-maat van"+n.minCutSize+"mm";case"max_cuts":return"U heeft het maximaal aantal knippen bereikt, u mag in totaal "+n.maxCuts+" maal knippen per plaat";case"same_size":return"De ingevoerde maat is even groot al de plaat die u wilt knippen, er is geen knip nodig";default:return""}};this.canvasObjectToObject=function(){return this[0].canvasObject.toObject()},this.canvasObjectToString=function(){return this[0].canvasObject.toString()},this.canvasObjectToSVG=function(){return this[0].canvasObject.toSVG()};var r=function(){var e=document.getElementById("canvas-container-block").offsetWidth;return Number(e)/Number(n.plateWidth)},d=function(){var e=r();return Number(n.fontSizePX)/Number(e)};this.setCanvasSize=function(){var e=this[0].canvasObject,t=r();return e.setZoom(t),e.setDimensions({width:n.plateWidth*t,height:n.plateHeight*t}),e};var o=function(e,t,i,r,d){var o=n.technicalPlateCutReferenceArray;return void 0===e&&(e=n.cutIdArray[0]),void 0===i&&(i=n.plateOrientation),void 0===r&&(r=!0),void 0===d&&(d=0),o.push({letter:e.replace("plateLetter_",""),length:t,orientation:i,full:r,price:d}),document.getElementById("cuts_array").value=JSON.stringify(o),o},l=function(e,t){for(var n="",i=0;i<t.length;i++)if(t[i].letter.replace("plateLetter_","")===e)if("landscape"===t[i].orientation){var r="";t[i].full||(r=" niet volledig de plaat in tween geknip");var d="";t[i].price>0&&(d=", á €"+t[i].price),n+="<li> <small> <b>Knip "+(i+1)+"</b> - in breedte geknipt "+t[i].length+"mm"+r+d+"</small></li>"}else{r="";t[i].full||(r=" niet volledig de plaat in tween geknip");d="";t[i].price>0&&(d=", á €"+t[i].price),n+="<li> <small> <b>Knip "+(i+1)+"</b> - in lengte geknipt "+t[i].length+"mm"+r+d+"</small></li>"}return""!==n?'<ul class="hidden-cut-information" style="display:none;">'+n+"</ul>":""},a=function(e,t,n){u();var i=document.getElementById("currentSelectedPlate").value;return e.forEachObject(function(e){e.id===i&&(document.getElementById("width").value=t,document.getElementById("width").setAttribute("max",t),document.getElementById("height").value=n,document.getElementById("height").setAttribute("max",n),document.getElementById("error-msg").textContent="",document.getElementById("width").classList.remove("was-validated"),document.getElementById("width").classList.remove("is-invalid"),document.getElementById("height").classList.remove("was-validated"),document.getElementById("height").classList.remove("is-invalid"))}),e},s=function(e){return n.cutIdArray[e]},u=function(){return document.querySelector(".rotate:checked").value};this.rotatePlate=function(e){return"landscape"===u()?(document.getElementById("width").disabled=!1,document.getElementById("height").disabled=!0,document.getElementById("width").focus()):(document.getElementById("width").disabled=!0,document.getElementById("height").disabled=!1,document.getElementById("height").focus()),this.setCutLinePosition(e),e};var c=function(e,t,i,r,d){if("landscape"===u()){t=t,i=i;var o=Number(t)+Number(r),l=Number(i)+Number(d),a=new fabric.Line([o-n.cutLineWidth,i,o-n.cutLineWidth,l],{strokeDashArray:n.visualCutLineDashArray,stroke:n.plateBorderColor,strokeWidth:n.cutLineWidth,id:"cutline",selectable:!1,hasControls:!1,absolutePositioned:!0,evented:!0});e.add(a)}else{t=t,i=i,o=Number(t)+Number(r),l=Number(i)+Number(d),a=new fabric.Line([t,i,o,i],{strokeDashArray:n.visualCutLineDashArray,stroke:n.visualCutLineColor,strokeWidth:n.cutLineWidth,id:"cutline",selectable:!1,hasControls:!1,absolutePositioned:!0,evented:!0});e.add(a)}return e},m=function(e){return e.forEachObject(function(t){"cutline"==t.id&&e.remove(t)}),e};this.setCutLinePosition=function(e){var t=Number(document.getElementById("width").value),i=Number(document.getElementById("width").getAttribute("max")),d=Number(document.getElementById("height").value),o=Number(document.getElementById("height").getAttribute("max"));if("landscape"===u())if(g(t,i,!0)){var l=document.getElementById("currentSelectedPlate").value;e.forEachObject(function(e){e.id===l&&(a=e.oCoords),"cutline"===e.id&&e.set({stroke:n.visualCutLineColor,x1:Number(a.tr.x/r())-(i-t+n.cutLineWidth),y1:Number(a.tr.y/r()),x2:Number(a.br.x/r())-(i-t+n.cutLineWidth),y2:Number(a.br.y/r())})}),e.renderAll()}else{l=document.getElementById("currentSelectedPlate").value;e.forEachObject(function(e){e.id===l&&(a=e.oCoords),"cutline"===e.id&&e.set({stroke:n.visualCutLineErrorColor,x1:Number(a.tr.x/r())-(i-t+n.cutLineWidth),y1:Number(a.tr.y/r()),x2:Number(a.br.x/r())-(i-t+n.cutLineWidth),y2:Number(a.br.y/r())})}),e.renderAll()}else if(g(d,o,!0)){l=document.getElementById("currentSelectedPlate").value;e.forEachObject(function(e){e.id===l&&(a=e.oCoords),"cutline"===e.id&&e.set({stroke:n.visualCutLineColor,x1:Number(a.tl.x/r()),y1:Number(a.tl.y/r())+(o-d+n.cutLineWidth),x2:Number(a.tr.x/r()),y2:Number(a.tr.y/r())+(o-d+n.cutLineWidth)})}),e.renderAll()}else{var a;l=document.getElementById("currentSelectedPlate").value;e.forEachObject(function(e){e.id===l&&(a=e.oCoords),"cutline"===e.id&&e.set({stroke:n.visualCutLineErrorColor,x1:Number(a.tl.x/r()),y1:Number(a.tl.y/r())+(o-d+n.cutLineWidth),x2:Number(a.tr.x/r()),y2:Number(a.tr.y/r())+(o-d+n.cutLineWidth)})}),e.renderAll()}return e};var h=function(e){e?(document.getElementById("cut").disabled=!1,document.getElementById("cut").classList.remove("disabled"),document.getElementById("undo").disabled=!1,document.getElementById("undo").classList.remove("disabled"),document.getElementById("redo").disabled=!1,document.getElementById("redo").classList.remove("disabled")):(document.getElementById("cut").disabled=!0,document.getElementById("cut").classList.add("disabled"),document.getElementById("undo").disabled=!0,document.getElementById("undo").classList.add("disabled"),document.getElementById("redo").disabled=!0,document.getElementById("redo").classList.add("disabled"))},g=function(e,t,r){void 0===r&&(r=!1);var d=u(),o=!0;return r?(e!==t?"landscape"===d?(Number(e)<Number(n.minCutSize)&&(document.getElementById("error-msg").textContent=i("cut_to_small"),document.getElementById("width").classList.add("was-validated"),document.getElementById("width").classList.add("is-invalid"),document.getElementById("error-msg-box").classList.add("show"),o=!1),Number(t)-Number(e)<Number(n.minCutSize)&&(document.getElementById("error-msg").textContent=i("remainder_to_small"),document.getElementById("width").classList.add("was-validated"),document.getElementById("width").classList.add("is-invalid"),document.getElementById("error-msg-box").classList.add("show"),o=!1)):(Number(e)<Number(n.minCutSize)&&(document.getElementById("error-msg").textContent=i("cut_to_small"),document.getElementById("height").classList.add("was-validated"),document.getElementById("height").classList.add("is-invalid"),document.getElementById("error-msg-box").classList.add("show"),o=!1),Number(t)-Number(e)<Number(n.minCutSize)&&(document.getElementById("error-msg").textContent=i("remainder_to_small"),document.getElementById("height").classList.add("was-validated"),document.getElementById("height").classList.add("is-invalid"),document.getElementById("error-msg-box").classList.add("show"),o=!1)):"landscape"===d?(document.getElementById("error-msg").textContent="",document.getElementById("error-msg-box").classList.remove("show"),document.getElementById("width").classList.add("was-validated"),document.getElementById("width").classList.add("is-invalid"),o=!1):(document.getElementById("error-msg").textContent="",document.getElementById("error-msg-box").classList.remove("show"),document.getElementById("height").classList.add("was-validated"),document.getElementById("height").classList.add("is-invalid"),o=!1),o?(document.getElementById("error-msg").textContent="",document.getElementById("width").classList.remove("was-validated"),document.getElementById("width").classList.remove("is-invalid"),document.getElementById("height").classList.remove("was-validated"),document.getElementById("height").classList.remove("is-invalid"),document.getElementById("error-msg-box").classList.remove("show"),h(!0)):h(!1)):(document.getElementById("error-msg").textContent="",document.getElementById("width").classList.remove("was-validated"),document.getElementById("width").classList.remove("is-invalid"),document.getElementById("height").classList.remove("was-validated"),document.getElementById("height").classList.remove("is-invalid"),document.getElementById("error-msg-box").classList.remove("show")),o};this.createFirstCutBlock=function(e){n.plateWidth,n.plateBorder,n.plateHeight,n.plateBorder,u();var t=s(0);document.getElementById("currentCutNumber").value=0;var i=new fabric.Text(t,{id:"plateLetter_"+t,left:n.plateWidth/2-d()/2+0,top:0+n.plateHeight/2-d()/2,fill:n.plateLetterColor,fontWeight:n.plateLetterFontWeight,fontSize:d(),fontFamily:n.plateLetterFontFamily,selectable:!1,hasControls:!1,absolutePositioned:!0,evented:!1}),r=new fabric.Rect({id:"plateBox_"+t,left:0,top:0,fill:n.activePlateBackgroundColor,width:n.plateWidth,height:n.plateHeight,hasBorder:!0,hasControls:!1,stroke:n.plateBorderColor,strokeWidth:1,selectable:!1,evented:!0,cancelBubble:!0}).on("mousedown",function(t){if(t.target){var i=this.width,r=this.height,d=this;return m(e),document.getElementById("error-msg-box").classList.remove("show"),e.forEachObject(function(t){-1!==t.id.indexOf("plateBox_")&&(t.setColor(n.plateBackgroundColor),d.id===t.id&&(c(e,t.left,t.top,i,r),d.setColor(n.activePlateBackgroundColor),document.getElementById("currentSelectedPlate").value=t.id,a(e,i,r)))}),!1}});return e.add(r,i),c(e,0,0,n.plateWidth,n.plateHeight),e};var b=function(e,t,i,d,o){var l=u(),s="";return e.forEachObject(function(u){if("landscape"==l){if(u.id===t)return a(e,d,o),u.set("width",Number(d)),u.setColor(n.activePlateBackgroundColor),u.setCoords(),s=u.oCoords;u.id===i&&(u.set("left",s.tl.x/r()+parseFloat(d)/2),u.setCoords())}else{if(u.id===t)return a(e,d,o),u.set("height",Number(o)),u.setColor(n.activePlateBackgroundColor),u.setCoords(),s=u.oCoords;u.id===i&&(u.set("top",s.tl.y/r()+parseFloat(o)/2),u.setCoords())}}),s},v=function(e,t,i,o,l){var s=d();if("landscape"==u()){var h=new fabric.Text(l,{id:"plateLetter_"+l,left:Number(t.tr.x)-Number(o)/2-Number(s),top:Number(t.tr.y)+Number(i)/2-Number(s)/2,fill:n.plateLetterColor,fontWeight:n.plateLetterFontWeight,selectable:!1,hasControls:!1,fontSize:s,fontFamily:n.plateLetterFontFamily}).setCoords(),g=new fabric.Rect({id:"plateBox_"+l,left:t.tr.x-o,top:t.tr.y,fill:n.plateBackgroundColor,width:o,height:i,hasBorder:!0,hasControls:!1,stroke:n.plateBorderColor,strokeWidth:1,selectable:!1,originX:"left",originY:"top"}).on("mousedown",function(i){var d=this.width,o=this.height,l=this;m(e),document.getElementById("error-msg-box").classList.remove("show"),e.forEachObject(function(i){-1!==i.id.indexOf("plateBox_")&&(i.setColor(n.plateBackgroundColor),l.id===i.id&&(l.setColor(n.activePlateBackgroundColor),document.getElementById("currentSelectedPlate").value=i.id,a(e,d,o),c(e,t.tl.x/r(),t.tl.y/r(),d,o)))})}).setCoords();e.add(g,h)}else{h=new fabric.Text(l,{id:"plateLetter_"+l,left:Number(t.tl.x)/r()+Number(o)/2-Number(s)/2,top:Number(t.tl.y)/r()+Number(i)/2-Number(s)/2,fill:n.plateLetterColor,fontWeight:n.plateLetterFontWeight,selectable:!1,hasControls:!1,fontSize:s,fontFamily:n.plateLetterFontFamily}).setCoords(),g=new fabric.Rect({id:"plateBox_"+l,left:Number(t.tl.x)/r(),top:Number(t.tl.y)/r(),fill:n.plateBackgroundColor,width:o,height:i,hasBorder:!0,hasControls:!1,stroke:n.plateBorderColor,strokeWidth:1,selectable:!1,originX:"left",originY:"top"}).on("mousedown",function(i){var d=this.width,o=this.height,l=this;m(e),document.getElementById("error-msg-box").classList.remove("show"),this.canvas.forEachObject(function(i){-1!==i.id.indexOf("plateBox_")&&(i.setColor(n.plateBackgroundColor),l.id===i.id&&(l.setColor(n.activePlateBackgroundColor),document.getElementById("currentSelectedPlate").value=i.id,a(e,d,o),c(e,t.tl.x/r(),t.tl.y/r(),d,o)))})}).setCoords();e.add(g,h)}return e};return this.cutActionPlate=function(e){var t=document.getElementById("currentCutNumber").value,r=Number(t)+1,d=u(),a=(s(r),document.getElementById("width").value),c=document.getElementById("height").value,m=document.getElementById("currentSelectedPlate").value,h=m.replace("plateBox_","plateLetter_");if(Number(t)>Number(n.maxCuts)-1)return document.getElementById("error-msg").textContent=i("max_cuts"),void document.getElementById("error-msg-box").classList.add("show");e.forEachObject(function(t){if(t.id===m){var n=t.width,i=t.height,l=t.aCoords;if("landscape"==d){if(g(a,n)){var u={tl:(y=b(e,m,h,Number(a),Number(c))).tr,tr:l.tr,bl:y.br,br:l.br};v(e,u,Number(c),Number(n)-Number(a),s(r)),document.getElementById("currentCutNumber").value=r,document.getElementById("undo").disabled=!1,document.getElementById("redo").disabled=!1,document.getElementById("cutTotal").textContent=r}o(h,a,d,!0,0)}else{if(g(c,i)){var y;u={tl:(y=b(e,m,h,Number(a),Number(c))).bl,tr:y.br,bl:l.bl,br:l.br};v(e,u,Number(i)-Number(c),Number(n),s(r)),document.getElementById("currentCutNumber").value=r,document.getElementById("undo").disabled=!1,document.getElementById("redo").disabled=!1,document.getElementById("cutTotal").textContent=r}o(h,c,d,!0,0)}}}),e.renderAll(),function(e){var t=n.technicalPlateCutReferenceArray,i="",r=[];e.forEachObject(function(e){if(-1!==e.id.indexOf("plateBox")){var n=e.id.replace("plateBox_",""),d=e.width,o=e.height;i+="<li>"+n+": "+d+"mm X "+o+"mm "+l(n,t)+"</li>",r.push({letter:n,width:d,height:o})}}),document.getElementById("plates_array").value=JSON.stringify(r),document.getElementById("cuttedPlatesList").innerHTML=i}(e)},this.initialize=function(){var e,t,n=this,i=(e=n[0],t=new fabric.Canvas(e,{isDrawingMode:!1,selection:!1}),e.canvasObject=t,t);n.setCanvasSize(),n.createFirstCutBlock(i),document.getElementById("cut").addEventListener("click",function(e){e.preventDefault(),n.cutActionPlate(i),"landscape"===document.querySelector("input.rotate:checked").value?document.querySelector('input.rotate[value="portrait"]').click():document.querySelector('input.rotate[value="landscape"]').click()},{passive:!1});var r=document.getElementById("width"),d=document.getElementById("height");r.addEventListener("change",function(e){n.setCutLinePosition(i)},{passive:!0}),r.addEventListener("wheel",function(e){n.setCutLinePosition(i)},{passive:!1}),r.addEventListener("keyup",function(e){n.setCutLinePosition(i),"Enter"===e.key&&document.getElementById("cut").click()},{passive:!0}),d.addEventListener("change",function(e){n.setCutLinePosition(i)},{passive:!0}),d.addEventListener("wheel",function(e){n.setCutLinePosition(i)},{passive:!1}),d.addEventListener("keyup",function(e){n.setCutLinePosition(i),"Enter"===e.key&&document.getElementById("cut").click()},{passive:!0});for(var o=document.getElementsByClassName("rotate"),l=0;l<o.length;l++)o[l].addEventListener("click",function(e){n.rotatePlate(i)},{passive:!1});return document.getElementById("width").focus(),n},this.initialize(),this}});